<script>
  function searchDramaList(filter) {
    const dramaList = document.getElementById('drama-list');
    if (!dramaList) {
      return;
    }
    const lis = dramaList.getElementsByTagName('li');
    const normalizedFilter = (filter || '').trim().toLowerCase();
    /* Split the query into keywords and capture the special "star" flag. */
    const tokens = normalizedFilter.length > 0 ? normalizedFilter.split(/\s+/) : [];
    const requireStar = tokens.includes('star');
    const keywords = tokens.filter(token => token !== 'star');
    for (let i = 0; i < lis.length; i++) {
      /* Get attributes. */
      let name = lis[i].textContent.toLowerCase();
      let star = lis[i].getAttribute('star');
      let platform = lis[i].getAttribute('platform').toLowerCase();
      let date = lis[i].getAttribute('date');
      let comment = '';
      if (lis[i].getElementsByClassName('tooltiptext').length > 0) {
        comment = lis[i].getElementsByClassName('tooltiptext')[0].textContent.toLowerCase();
      }

      let shouldShow = true;

      if (requireStar && star !== 'true') {
        shouldShow = false;
      }

      if (shouldShow && keywords.length > 0) {
        const searchFields = [name, platform, date, comment];
        shouldShow = keywords.every(keyword =>
          searchFields.some(field => field.indexOf(keyword) !== -1)
        );
      }

      lis[i].style.display = shouldShow ? 'list-item' : 'none';
    }
  }

  document.addEventListener('DOMContentLoaded', () => {
    const searchEle = document.getElementById('search');
    const inputEle = document.getElementById('searchInput');
    const searchButton = document.getElementById('searchButton');
    const searchIcon = searchButton.querySelector('.search-icon');
    const closeIcon = searchButton.querySelector('.close-icon');

    searchButton.addEventListener('click', (e) => {
      const isExpanded = searchEle.classList.contains('search--expanded');
      if (!isExpanded) {
        inputEle.focus();
        searchIcon.style.display = 'none';
        closeIcon.style.display = 'block';
      } else {
        inputEle.value = '';
        searchDramaList('');
        searchIcon.style.display = 'block';
        closeIcon.style.display = 'none';
      }
      searchEle.classList.toggle('search--expanded');
    });
    inputEle.addEventListener('input', (e) => {
      const filter = e.target.value.toLowerCase();
      searchDramaList(filter);
    });

    /* Handle scroll event to fix search button on top. */
    const offset = searchEle.offsetTop;
    window.onscroll = function() {
      if (window.pageYOffset > offset) {
        searchEle.classList.add('search--fixed');
        document.getElementById('searchSpacer').classList.add('search__spacer');
      } else {
        searchEle.classList.remove('search--fixed');
        document.getElementById('searchSpacer').classList.remove('search__spacer');
      }
    };
  });
</script>

<div class="searchbox">
  <div class="search" id="search">
    <input type="text" class="search__input" id="searchInput" placeholder="" />
    <button class="search__button" id="searchButton">
      <svg class="search__icon search-icon" focusable="false" viewBox="0 0 24 24">
        <path
          d="M10.5,0.5c5.523,0,10,4.477,10,10s-4.477,10-10,10s-10-4.477-10-10S4.977,0.5,10.5,0.5z M23.5,23.5 l-5.929-5.929">
        </path>
      </svg>
      <svg class="search__icon close-icon" focusable="false" viewBox="0 0 24 24" style="display: none;">
        <path
          d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z">
        </path>
      </svg>
    </button>
  </div>
  <div id="searchSpacer" class="search__spacer"></div>
</div>
